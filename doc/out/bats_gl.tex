\section{Qué imos facer? Qué se describe en este
documento?}\label{quuxe9-imos-facer-quuxe9-se-describe-en-este-documento}

Imos deseñar un shield para Arduino. Usando
\href{http://www.kicad-pcb.org/}{KiCad}

Daremos unha visión xeral da funcionalidade da suite KiCad pero non
vamos a redactar un tutorial detallado nin de deseño de circuitos nin do
mesmo KiCad. Daremos as pistas xustiñas para empezar a traballar con
KiCad, se queredes un tutorial detallado, en youtube tedes un super
recomendable, elaborado por
\href{https://www.youtube.com/playlist?list=PL1Hs_F1k2mdRVYDtdWd7tQKDZTfxop7np}{TutoElectro}

Tamén comentaremos a nivel xeral os pasos para desenvolver este
proxecto.

\section{Qué é KiCad?}\label{quuxe9-uxe9-kicad}

KiCad é unha suite de deseño electrónico automatizado \footnote{EDA
  suite en inglés}. KiCad permite o deseño tanto de esquemas de
circuitos como das placas de circuito impreso a nivel profesional. Hai
versións de KiCad dispoñibles para Windows, Linux, Apple OS X. A suite
está dispoñible para Windows, Linux e Apple OS X. É un programa gratuito
e \textbf{libre} distribuido baixo licencia \textbf{GNU GPL v2}.

Mellor ainda, a suite KiCad é a elexida polo CERN para o desenvolvemento
e deseño de electrónica. É de esperar que con este respaldo a suite
mellore ainda mais.

\section{Requisitos do shield}\label{requisitos-do-shield}

Queremos facer un shield sinxelo para a enseñanza.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  3-4 x Botóns
\item
  1 x RGB
\item
  1 x LDR
\item
  1 x Pines servo
\item
  1 x sensor temp (dudoso)
\item
  2 x potenciómetros
\item
  1 x LED vermello
\item
  1 x LED amarelo
\item
  1 x LED verde
\item
  1 x Zoador
\item
  1 x Botón de reset
\end{itemize}

\section{Instalación de KiCad (en
Ubuntu)}\label{instalaciuxf3n-de-kicad-en-ubuntu}

Para instalar o KiCad en Ubuntu basta con facer o típico ciclo de
instalación:

\begin{verbatim}
sudo apt-get install kicad
\end{verbatim}

Se queremos estar á última temos o ppa de Monsieur Reynaud dispoñible:

\begin{verbatim}
sudo apt-add-repository ppa:js-reynaud/ppa-KiCad
sudo apt-get update
sudo apt-get install kicad
\end{verbatim}

Nos escollimos esta opción.

Se non usades un linux baseado en Debian, teredes que consultar na rede
como facer a instalación para o voso sistema operativo. De todolos
xeitos a instalación é moi doada, donde podemos atopar algún problemiña
é na instalación das bibliotecas de compoñentes que vos contaremos cos
mais detalle mais adiante.

\section{Configuración de directorios para este
proxecto}\label{configuraciuxf3n-de-directorios-para-este-proxecto}

Además de desenvolver o proxecto con KiCad queremos ter o proxecto
dispoñible en github.

Agora que temos KiCad instalado imos preparar un directorio de traballo
ao que chamamos \textbf{bats}.

O directorio \textbf{bats} será o ``repositorio'' ou depósito do noso
proxecto para git. Contén os seguintes subdirectorios:

doc

: Contén a documentación do proxecto (o que estás a leer agora mesmo)
redactada en \href{http://pandoc.org/}{Pandoc}

kicad

: Contén o proxecto KiCad

Unha vez que temos preparado o directorio do proxecto activamos git para
iniciar o control de versións.

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

Describir a configuración de git??

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\section{Biblioteca de compoñentes incluindo un shield para
Arduino}\label{biblioteca-de-compouxf1entes-incluindo-un-shield-para-arduino}

As bibliotecas de KiCad están organizadas en duas partes:

\begin{itemize}
\item
  Un ficheiro que contén os símbolos dos compoñentes para usarse no
  editor de esquemas electrónicos \textbf{Eescheme}
\item
  As pegadas dos compoñentes electrónicos, é dicir, a forma que ten que
  ter a pista da placa de circuito impreso (\emph{PCB}) para poder
  soldar o compoñente.
\end{itemize}

O KiCad non trae por defecto unha biblioteca de compoñentes que inclúa
shields de Arduino. Pero non hai problema hai bibliotecas que podemos
descarregar da rede.

Unha biblioteca moi completa é a de Freetronics que podemos atopar tamén
en github en:

\url{https://github.com/freetronics/freetronics_KiCad_library.git}

As bibliotecas de KiCad poden estar almacenadas en diferentes
directorios do noso ordenador. Poderíamos engadir as bibliotecas que
usemos en algún subdirectorio de \emph{/usr/share/kicad} ou de
\emph{/usr/local/share}. Esta podería ser unha boa estratexia nun
servidor compartido por varios usuarios. Tamén poderíamos descarregar
todas as bibliotecas a un directorio común do noso \emph{home}. Pero
como estamos facendo un control de versións do noso proxecto con git a
propia páxina da biblioteca suxírenos o xeito mais adoitado de facer a
instalación: coma un submódulo git do noso proxecto.

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

Describir as vantaxes de usar un git submodule

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Engadir a biblioteca como un submódulo de
git}\label{engadir-a-biblioteca-como-un-submuxf3dulo-de-git}

Dende o directorio principal de noso proxecto descarregamos a biblioteca
de Freetronics coma un submodulo do noso proxecto:

\begin{verbatim}
git submodule add https://github.com/freetronics/freetronics_kicad_library.git kicad/ftlibrary
\end{verbatim}

Despois de engadir a biblioteca como un submódulo se consultamos o
estado git do noso proxecto aparecerán dous novos ficheiros:

\begin{verbatim}
$ git status
On branch master
Your branch is up-to-date with 'origin/master'.
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

    new file:   .gitmodules
    new file:   kicad/ftlibrary
\end{verbatim}

Git engadíu automáticamente os dous novos ficheiros, o directorio que
contén a nosa biblioteca eo ficheiro \textbf{.gitmodule} que levará o
control de todolos submódulos que usemos.

En realidade os ficheiros que compoñen a biblioteca non pertencen ao
noso depósito de software, git só leva conta da versión da biblioteca de
Freetronics que estamos a usar.

Se queres saber mais de esta potente funcionalidade de git podes leer:
\url{http://www.git-scm.com/book/en/v2/Git-Tools-Submodules}

\subsection{\texorpdfstring{Configurar \emph{Eescheme} para usar a nova
biblioteca}{Configurar Eescheme para usar a nova biblioteca}}\label{configurar-eescheme-para-usar-a-nova-biblioteca}

No menú Preferences -\textgreater{} Component Library sinalamos na ventá
inferior o directorio do noso proxecto. Na ventá superior engadimos o
ficheiro da biblioteca.

No github da biblioteca nos aconsellan poñer a biblioteca de primeira na
nosa lista por que definen todo tipo de compoñentes. Nos de momento
seguimos o consello de Freetronics, e a puxemos de primeira.

\subsection{\texorpdfstring{Configurar acceso aos datos de pegadas
(\emph{footprints}) en
pcbnew}{Configurar acceso aos datos de pegadas (footprints) en pcbnew}}\label{configurar-acceso-aos-datos-de-pegadas-footprints-en-pcbnew}

Configuramos un ficheiro para o noso proxecto declarando os
\emph{footprint} extra que imos a utilizar.

\begin{verbatim}
(fp_lib_table
  (lib
   (name FT)
   (type KiCad)
   (uri ${KIPRJMOD}/ftlibrary/freetronics_footprints.pretty)
   (options "")
   (descr "Freetronics Kicad Library")
   )
)
\end{verbatim}

Engadimos o novo ficheiro ao noso repositorio

\begin{verbatim}
git add fp-lib-table
\end{verbatim}

Abrimos \emph{Pcbnew} e no menú
\emph{Preferences-\textgreater{}Footprint Libraries Manager} comprobamos
que na pestaña \emph{Project Specific Libraries} figura o noso ficheiro.

\subsection{Outra biblioteca moi
currada}\label{outra-biblioteca-moi-currada}

\url{git://smisioto.eu/KiCad_libs.git}

\subsection{Ainda mais bibliotecas}\label{ainda-mais-bibliotecas}

\url{http://www.kicadlib.org/}

\subsection{Instalación das
bibliotecas}\label{instalaciuxf3n-das-bibliotecas}

\url{http://www.arunet.co.uk/tkboyd/ele2pcbka.htm}

\section{Tutorial}\label{tutorial}

\subsection{A pantalla xeral}\label{a-pantalla-xeral}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

Pantalla xeral de KiCad opcións, citar a lista de hotkeys

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Abrindo un proxecto}\label{abrindo-un-proxecto}

Abrimos un novo proxecto: File::New Project (Ctrl+N) \textbf{bats}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

falar das propiedades do documento

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\subsection{Crear e Editar o esquema do
circuito}\label{crear-e-editar-o-esquema-do-circuito}

O primeiro que imos facer é o esquema do circuito. Para isto temos que
usar a ferramenta \emph{Eeschema} que podemos atopar en tres lugares
diferentes \footnote{Isto de ter varios xeitos de facer unha cousa é
  habitual en KiCad como iremos vendo} na barra de iconos de
ferramentas, no menú de KiCad no título da fiestra, ou có atallo
\textbf{Ctrl+E}.

Abrimos eescheme e creamos un novo ficheiro de esquema.

\subsubsection{Checklist}\label{checklist}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Crear o esquema do circuito (usando Eescheme)
\item
  Chequeo de erros (opción \emph{Perform Electrical Rules Check})
\item
  Xerar o ficheiro NET (opción \emph{Generate netlist})
\item
  Asignar as pegadas (\emph{footprints}) aos compoñentes (opción
  \emph{run CvPcb})
\end{itemize}

\subsubsection{Tips}\label{tips}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Falar dos flags

  \begin{itemize}
  \itemsep1pt\parskip0pt\parsep0pt
  \item
    Power flags
  \item
    Not used flag
  \end{itemize}
\item
  Falar dos ficheiros de pegadas
\item
  Falar da asignación automática de pegadas
\end{itemize}

\section{Meta}\label{meta}

Este documento está escrito en
\href{http://pandoc.org/README.html}{Markdown-Pandoc}. Pandoc e un
sistema moi sinxelo de documentación que permite xerar multiples
formatos de saída.

As fontes do documento están no directorio \textbf{doc/src}. Os formatos
de saída son este fichero \textbf{README.md} en formato Markdown-github
e os documentos que podes atopar no directorio \textbf{doc/out}
incluindo un pdf.

Os documentos xeneranse automáticamente a partir do ficheiro fonte sen
mai que executar:

\begin{verbatim}
$ cd doc
$ ./makeDoc
\end{verbatim}

É importante cambiar ao directorio doc antes de executar o
\textbf{makeDoc}.
